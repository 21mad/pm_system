<!--Main Navigation-->
<header>
  <!-- Sidebar -->
  <div class="d-inline-flex flex-column flex-shrink-0 p-3 bg-white" style="width: 15%; height: 100vh; float: left; position: fixed; border-right: solid 1px; border-color: #dcdddd">
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
      <div class="nav-link" style="color: black; font-weight: bold"><%= @project.active ? "Активные проекты" : "Завершенные проекты"%></div>
      <hr style="margin-top: 0">
      <% @projects.each do |project|%>
        <% if project.active == @project.active %>
          <li>
            <div class="nav-link <%= project.id == @project.id ? 'active' : '' %>">
              <a href="<%= project_path(project) %>" style="color: black; text-decoration: none"><%= project.name %></a>
            </div>
          </li>
        <% end %>
      <% end %>
    </ul>
    <hr>
    <p><%= button_to "Новый проект", new_project_path, class: "btn btn-success", style: "width: 100%", method: :get %></p>
  </div>
  <!-- Sidebar -->

  <!-- Navbar -->
  <nav id="main-navbar" class="navbar navbar-expand-lg navbar-light bg-white fixed-top" style="height: 64px; border-bottom: solid 1px; border-color: #dcdddd">
    <!-- Container wrapper -->
    <div class="container-fluid">
      <!-- Toggle button -->
      <!-- Brand -->
      <a class="navbar-brand" href="<%= projects_path %>">
        <img
             src="https://www.projectmanager.com/wp-content/uploads/2022/04/PM-logo-email.png"
             height="50"
             alt=""
             loading="lazy"
             />
      </a>
      <a href="<%= projects_path %>" style="font-size: 28px; text-decoration: none; color: black">Project Minder</a>
      <!-- Right links -->
      <ul class="navbar-nav ms-auto d-flex flex-row">
        <li>
          <a class="nav-link <%= @project.active ? "active" : "" %>" href="<%= projects_path %>">Активные</a>
        </li>
        <li>
          <a class="nav-link <%= !@project.active ? "active" : "" %>" href="<%= finished_projects_path %>">Завершенные</a>
        </li>
        <li>
          <a class="nav-link" href="<%= analytics_projects_path %>">Аналитика</a>
        </li>
        <li>
          <a class="nav-link" href="#">Пользователи</a>
        </li>
        <!-- Notification dropdown -->
        <li class="nav-item dropdown">
          <a
             class="nav-link me-3 me-lg-0 dropdown-toggle hidden-arrow"
             href="#"
             id="navbarDropdownMenuLink"
             role="button"
             data-mdb-toggle="dropdown"
             aria-expanded="false"
             >
            <i class="fas fa-bell"></i>
            <span class="badge rounded-pill badge-notification bg-danger"
                  >1</span
              >
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink"
              >
            <li><a class="dropdown-item" href="#">Some news</a></li>
            <li><a class="dropdown-item" href="#">Another news</a></li>
            <li>
              <a class="dropdown-item" href="#">Something else here</a>
            </li>
          </ul>
        </li>

        <!-- Icon -->
        <li class="nav-item">
          <a class="nav-link me-3 me-lg-0" href="#">
            <i class="fas fa-fill-drip"></i>
          </a>
        </li>
        <!-- Icon -->
        <li class="nav-item me-3 me-lg-0">
          <a class="nav-link" href="#">
            <i class="fab fa-github"></i>
          </a>
        </li>

        <!-- Icon dropdown -->
        <li class="nav-item">
          <a
             class="nav-link me-3 me-lg-0 dropdown-toggle hidden-arrow"
             href="#"
             id="navbarDropdown"
             role="button"
             data-mdb-toggle="dropdown"
             aria-expanded="false"
             >
            <i class="united kingdom flag m-0"></i>
          </a>
          <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="navbarDropdown"
              >
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="united kingdom flag"></i>English
                <i class="fa fa-check text-success ms-2"></i
                  ></a>
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="poland flag"></i>Polski</a
                >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="china flag"></i>中文</a
                >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="japan flag"></i>日本語</a
                >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="germany flag"></i>Deutsch</a
                >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="france flag"></i>Français</a
                >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="spain flag"></i>Español</a
                >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="russia flag"></i>Русский</a
                >
            </li>
            <li>
              <a class="dropdown-item" href="#"
                 ><i class="portugal flag"></i>Português</a
                >
            </li>
          </ul>
        </li>

        <!-- Avatar -->
        <li class="nav-item dropdown">
          <a
             class="nav-link dropdown-toggle hidden-arrow d-flex align-items-center"
             href="#"
             id="navbarDropdownMenuLink"
             role="button"
             data-mdb-toggle="dropdown"
             aria-expanded="false"
             >
            <img
                 src="https://mdbootstrap.com/img/Photos/Avatars/img (31).jpg"
                 class="rounded-circle"
                 height="22"
                 alt=""
                 loading="lazy"
                 />
          </a>
          <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="navbarDropdownMenuLink"
              >
            <li><a class="dropdown-item" href="#">My profile</a></li>
            <li><a class="dropdown-item" href="#">Settings</a></li>
            <li><a class="dropdown-item" href="#">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
    <!-- Container wrapper -->
  </nav>
  <!-- Navbar -->
</header>
<!--Main Navigation-->

<!--Main layout-->
<main style="margin-top: 20px">
  <div class="container" style="padding-top: 40px">
    <p style="color: green"><%= notice %></p>
    <%= render @project %>

    <h1>Задачи</h1>

    <h2>Добавить задачу (если ты PM)</h2>
    <%# params.require(:task).permit(:name, :description, :priority, :status, :due_date) %>
    <div style="color: red"><%= flash[:error] %></div>
    <% if @task.errors.any? %>
      <div style="color: red">
        <h2>При сохранении проекта возникли ошибки:</h2>

        <ul>
          <% project.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <%= form_with model: @task do |f| %>
      <div class="container">
        <div>
          <%= f.label :name, 'Задача', class: 'form-label', for: 'task-name' %>
          <%= f.text_field :name, class: 'form-control', id: 'task-name' %>
        </div>
        <div>
          <%= f.label :priority, 'Приоритет', class: 'form-label', for: 'task-priority' %>
          <%= f.number_field :priority, class: 'form-control', id: 'task-priority' %>
        </div>
        <div>
          <%= f.label :due_date, 'Дедлайн', class: 'form-label', for: 'task-deadline' %>
          <%= f.date_field :due_date, class: 'form-control', id: 'task-deadline' %>
        </div>
        <%= f.hidden_field :status, value: false %>
        <%= f.hidden_field :project_id, value: @project.id %>
        <div><%= f.submit 'Добавить задачу'%></div>
      </div>
    <% end %>
    <p>Задача приоритет статус дедлайн</p>
    <ul>
      <% @project.tasks.each do |task| %>
        <li id=row<%= task.id %>><%= button_to task.status ? 'Вернуть' : 'Сделать', task_path(task.id), method: :patch %> <%= task.id %> <%= task.name%> <%= task.priority %> <%= task.status %> <%= task.due_date %><%= button_to 'Удалить', task_path(task.id), method: :delete %></li>
      <% end %>
    </ul>

    <div>
      <%= link_to "Редактировать данный проект", edit_project_path(@project) %> |
      <%= link_to "Назад к проектам", projects_path %>

      <%= button_to "Удалить проект", @project, method: :delete %>
    </div>
    <div class="calendar-section">
      <h1>Календарь</h1>
      <%= turbo_frame_tag 'calendar' do %>
        <%= month_calendar do |date| %>
          <div class="day"><%= date.day %></div>
          <div class="tasks-for-day">
            <ul>
              <% @project.tasks.where(due_date: date).each do |this_day_task|%>
                <li style="<%= this_day_task.status == true ? "text-decoration: line-through" : "" %>"><%= this_day_task.name %></li>
              <% end %>
            </ul>
          </div>
          <% if date == @project.deadline %>
            <div class="deadline" style="color: red">Дедлайн!</div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</main>
<!--Main layout-->
